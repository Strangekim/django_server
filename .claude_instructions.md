# Django 메모 앱 프로젝트 작업 규칙

## 필수 확인 사항

### 1. 백엔드 데이터 무결성 점검
- `sessionData.strokes`, `sessionData.events`, `sessionData.stats` 수정 시 **반드시** 백엔드 전송 데이터 점검
- `getSubmissionData()`, `generateSessionData()`, `getVisibleStrokes()` 함수 영향 분석
- 수정 후 점검 결과를 사용자에게 보고

### 2. 한글 주석 작성
- 모든 코드 주석은 **한글**로 작성
- 함수 docstring, 인라인 주석, 변수 설명 모두 한글 사용
- 예외: 영어가 더 명확한 기술 용어 (예: historyIndex, RAF 등)

### 3. 문제 분석 우선 원칙
- 코드 수정 전 **반드시 문제 원인을 먼저 파악**
- 원인 분석 결과를 사용자에게 설명
- 사용자 승인 후 수정 진행

### 4. 불확실성 처리
- 추측하지 말고 **질문**
- 여러 해결 방법이 있으면 옵션 제시
- 의도가 불명확하면 확인 요청

## 코드 수정 플로우

```
1. 요구사항 분석
   ↓
2. 관련 코드 읽기 및 문제점 파악
   ↓
3. 원인 및 해결 방안 설명 (사용자에게)
   ↓
4. (필요시) 사용자 확인
   ↓
5. 코드 수정
   ↓
6. 영향 범위 점검 (특히 백엔드 데이터)
   ↓
7. 점검 결과 보고
```

## 특별 주의 영역

### Canvas 렌더링 관련
- `redrawCanvas()`, `saveToHistory()`, `getVisibleStrokes()` 수정 시 전체 히스토리 로직 점검
- `historyIndex`, `historyStep` 값의 일관성 확인
- Zoom/Pan transform 좌표계 주의

### 히스토리 (Undo/Redo)
- `historyIndex` 할당 타이밍 절대 변경 금지 (스트로크 완료 시점에만 할당)
- `saveToHistory()` 호출 순서 주의
- Redo 분기 처리 확인

### API 통신
- 백엔드로 전송되는 JSON 구조 절대 변경 금지
- `sessionData` 수집 로직은 렌더링 로직과 완전 분리 유지
- S3 URL, session_id 등 메타데이터 보존

## 금지 사항
- ❌ 백엔드 데이터 구조 임의 변경
- ❌ 점검 없이 히스토리 로직 수정
- ❌ 영어 주석 사용
- ❌ 문제 원인 파악 전 바로 코드 수정
- ❌ 불확실한 상태에서 추측으로 진행

## TodoList 사용 규칙
- 3단계 이상의 복잡한 작업 시 TodoWrite 도구 사용
- 각 단계 완료 시 즉시 상태 업데이트
- 작업 시작 전 todo 생성하여 계획 공유
